# Milestone v1.2: Stability Complete

**Status:** SHIPPED 2026-01-24
**Phases:** 7-8
**Total Plans:** 13

## Overview

Complete all remaining P2 and P3 stability issues from the v1 audit, making firmware production-ready. This milestone addressed 11 P2 issues (LVGL thread-safety, allocation patterns, BLE cache, documentation) and 9 P3 issues (memory pools, shutdown safety, concurrency documentation).

## Phases

### Phase 7: P2 Production Readiness

**Goal**: Fix all P2 medium-severity issues to make firmware production-ready
**Depends on**: Phase 6 (v1.1 complete)
**Requirements**: MEM-M1, MEM-M2, MEM-M3, CONC-M1, CONC-M2, CONC-M3, CONC-M5, CONC-M6, CONC-M7, CONC-M8, CONC-M9
**Plans**: 5 plans

- [x] 07-01: LVGL Mutex Thread Safety — Added LVGL_LOCK to all screen constructors/destructors, 5s debug timeout
- [x] 07-02: Memory Allocation Optimization — Bytes make_shared, PacketReceipt deferred allocation
- [x] 07-03: BLE Cache Bounds — LRU eviction with connected device protection
- [x] 07-04: I2S Timeout Safety — Bounded timeout replacing portMAX_DELAY
- [x] 07-05: Concurrency Documentation — CONCURRENCY.md with mutex ordering

### Phase 8: P3 Optimization & Hardening

**Goal**: Complete P3 optimizations and hardening for long-term stability
**Depends on**: Phase 7
**Requirements**: MEM-H1, MEM-H2, MEM-H3, MEM-L1, CONC-H4, CONC-M4, CONC-L1, CONC-L2, CONC-L4
**Plans**: 8 plans

- [x] 08-01: Quick wins — toHex reserve, ArduinoJson v7 API migration
- [x] 08-02: Debug timeouts — Remaining portMAX_DELAY sites
- [x] 08-03: Documentation — Volatile and delay rationale
- [x] 08-04: Pool allocators — ObjectPool template, Packet inline buffers
- [x] 08-05: BLE graceful shutdown — 10s timeout for active operations
- [x] 08-06: BytesPool integration — 4-tier pool for Bytes Data objects
- [x] 08-07: Packet/Receipt pools — ObjectPool integration
- [x] 08-08: Pool resilience — Exhaustion visibility and graceful fallback

---

## Milestone Summary

**Key Decisions:**
- 5s debug timeout for LVGL mutex (balance between detection and false positives)
- 4-tier BytesPool (64/256/512/1024 bytes) tuned from runtime observation
- 10s graceful shutdown timeout for BLE operations
- Unclean shutdown flag for recovery detection

**Issues Resolved:**
- LVGL race conditions during screen transitions
- Unbounded BLE discovered devices cache
- Per-packet heap fragmentation
- Missing mutex ordering documentation

**Technical Debt Incurred:**
- Native build has pre-existing msgpack compatibility issues (unrelated to stability)
- Known destinations pool limit at 192 entries (Transport layer, not addressed in this milestone)

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-01-24*
